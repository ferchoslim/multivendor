"use strict";(function(){var X=15;CKEDITOR.plugins.add("widget",{lang:"af,ar,ca,cs,cy,da,de,el,en,en-gb,eo,es,fa,fi,fr,gl,he,hr,hu,it,ja,km,ko,ku,nb,nl,no,pl,pt,pt-br,ru,sk,sl,sv,tr,tt,uk,vi,zh,zh-cn",requires:"lineutils,clipboard",onLoad:function(){CKEDITOR.addCss(".cke_widget_wrapper{position:relative;outline:none}.cke_widget_inline{display:inline-block}.cke_widget_wrapper:hover>.cke_widget_element{outline:2px solid deepskyblue;cursor:default}.cke_widget_wrapper:hover .cke_widget_editable{outline:2px solid deepskyblue}.cke_widget_wrapper.cke_widget_focused>.cke_widget_element,.cke_widget_wrapper .cke_widget_editable.cke_widget_editable_focused{outline:2px solid #607998}.cke_widget_editable{cursor:text}.cke_widget_drag_handler_container{position:absolute;width:"+X+"px;height:0;left:-9999px;opacity:0.75;transition:height 0s 0.2s;line-height:0}.cke_widget_wrapper:hover>.cke_widget_drag_handler_container{height:"+X+"px;transition:none}.cke_widget_drag_handler_container:hover{opacity:1}img.cke_widget_drag_handler{cursor:move;width:"+X+"px;height:"+X+"px;display:inline-block}.cke_widget_mask{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.cke_editable.cke_widget_dragging, .cke_editable.cke_widget_dragging *{cursor:move !important}");},beforeInit:function(ai){ai.widgets=new ah(ai);},afterInit:function(ai){B(ai);R(ai);}});function ah(ai){this.editor=ai;this.registered={};this.instances={};this.selected=[];this.focused=null;this.widgetHoldingFocusedEditable=null;this._={nextId:0,upcasts:[],upcastCallbacks:[],filters:{}};o(this);Q(this);L(this);ac(this);Z(this);ag(this);}ah.prototype={MIN_SELECTION_CHECK_INTERVAL:500,add:function(aj,ai){ai=CKEDITOR.tools.prototypedCopy(ai);ai.name=aj;ai._=ai._||{};this.editor.fire("widgetDefinition",ai);if(ai.template){ai.template=new CKEDITOR.template(ai.template);}n(this.editor,ai);t(this,ai);this.registered[aj]=ai;return ai;},addUpcastCallback:function(ai){this._.upcastCallbacks.push(ai);},checkSelection:function(){var ak=this.editor.getSelection(),an=ak.getSelectedElement(),am=af(this),aj;if(an&&(aj=this.getByElement(an,true))){return am.focus(aj).select(aj).commit();}var ai=ak.getRanges()[0];if(!ai||ai.collapsed){return am.commit();}var al=new CKEDITOR.dom.walker(ai),ao;al.evaluator=y;while((ao=al.next())){am.select(this.getByElement(ao));}am.commit();},checkWidgets:function(ai){this.fire("checkWidgets",CKEDITOR.tools.copy(ai||{}));},del:function(al){if(this.focused===al){var aj=al.editor,ai=aj.createRange(),ak;if(!(ak=ai.moveToClosestEditablePosition(al.wrapper,true))){ak=ai.moveToClosestEditablePosition(al.wrapper,false);}if(ak){aj.getSelection().selectRanges([ai]);}}al.wrapper.remove();this.destroy(al,true);},destroy:function(aj,ai){if(this.widgetHoldingFocusedEditable===aj){S(this,aj,null,ai);}aj.destroy(ai);delete this.instances[aj.id];this.fire("instanceDestroyed",aj);},destroyAll:function(ai){var ak=this.instances,aj;for(var al in ak){aj=ak[al];this.destroy(aj,ai);}},finalizeCreation:function(ai){var ak=ai.getFirst();if(ak&&y(ak)){this.editor.insertElement(ak);var aj=this.getByElement(ak);aj.ready=true;aj.fire("ready");aj.focus();}},getByElement:(function(){var aj={div:1,span:1};function ai(ak){return ak.is(aj)&&ak.data("cke-widget-id");}return function(al,an){if(!al){return null;}var am=ai(al);if(!an&&!am){var ak=this.editor.editable();do{al=al.getParent();}while(al&&!al.equals(ak)&&!(am=ai(al)));}return this.instances[am]||null;};})(),initOn:function(ak,ai,aj){if(!ai){ai=this.registered[ak.data("widget")];}else{if(typeof ai=="string"){ai=this.registered[ai];}}if(!ai){return null;}var am=this.wrapElement(ak,ai.name);if(am){if(am.hasClass("cke_widget_new")){var al=new h(this,this._.nextId++,ak,ai,aj);if(al.isInited()){this.instances[al.id]=al;return al;}else{return null;}}return this.getByElement(ak);}return null;},initOnAll:function(ak){var aj=(ak||this.editor.editable()).find(".cke_widget_new"),al=[],ai;for(var am=aj.count();am--;){ai=this.initOn(aj.getItem(am).getFirst(r));if(ai){al.push(ai);}}return al;},parseElementClasses:function(aj){if(!aj){return null;}aj=CKEDITOR.tools.trim(aj).split(/\s+/);var ai,ak={},al=0;while((ai=aj.pop())){if(ai.indexOf("cke_")==-1){ak[ai]=al=1;}}return al?ak:null;},wrapElement:function(ak,an){var ao=null,ai,am;if(ak instanceof CKEDITOR.dom.element){ai=this.registered[an||ak.data("widget")];if(!ai){return null;}ao=ak.getParent();if(ao&&ao.type==CKEDITOR.NODE_ELEMENT&&ao.data("cke-widget-wrapper")){return ao;}if(!ak.hasAttribute("data-cke-widget-keep-attr")){ak.data("cke-widget-keep-attr",ak.data("widget")?1:0);}if(an){ak.data("widget",an);}am=I(ai,ak.getName());ao=new CKEDITOR.dom.element(am?"span":"div");ao.setAttributes(G(am));ao.data("cke-display-name",ai.pathName?ai.pathName:ak.getName());if(ak.getParent(true)){ao.replace(ak);}ak.appendTo(ao);}else{if(ak instanceof CKEDITOR.htmlParser.element){ai=this.registered[an||ak.attributes["data-widget"]];if(!ai){return null;}ao=ak.parent;if(ao&&ao.type==CKEDITOR.NODE_ELEMENT&&ao.attributes["data-cke-widget-wrapper"]){return ao;}if(!("data-cke-widget-keep-attr" in ak.attributes)){ak.attributes["data-cke-widget-keep-attr"]=ak.attributes["data-widget"]?1:0;}if(an){ak.attributes["data-widget"]=an;}am=I(ai,ak.name);ao=new CKEDITOR.htmlParser.element(am?"span":"div",G(am));ao.attributes["data-cke-display-name"]=ai.pathName?ai.pathName:ak.name;var al=ak.parent,aj;if(al){aj=ak.getIndex();ak.remove();}ao.add(ak);al&&aa(al,aj,ao);}}return ao;},_tests_getNestedEditable:v,_tests_createEditableFilter:f};CKEDITOR.event.implementOn(ah.prototype);function h(am,an,ak,ai,aj){var al=am.editor;CKEDITOR.tools.extend(this,ai,{editor:al,id:an,inline:ak.getParent().getName()=="span",element:ak,data:CKEDITOR.tools.extend({},typeof ai.defaults=="function"?ai.defaults():ai.defaults),dataReady:false,inited:false,ready:false,edit:h.prototype.edit,focusedEditable:null,definition:ai,repository:am,draggable:ai.draggable!==false,_:{downcastFn:(ai.downcast&&typeof ai.downcast=="string")?ai.downcasts[ai.downcast]:ai.downcast}},true);am.fire("instanceCreated",this);l(this,ai);this.init&&this.init();this.inited=true;u(this,aj);if(this.isInited()&&al.editable().contains(this.wrapper)){this.ready=true;this.fire("ready");}}h.prototype={addClass:function(ai){this.element.addClass(ai);},applyStyle:function(ai){m(this,ai,1);},checkStyleActive:function(ak){var aj=z(ak),ai;if(!aj){return false;}while((ai=aj.pop())){if(!this.hasClass(ai)){return false;}}return true;},destroy:function(ai){this.fire("destroy");if(this.editables){for(var aj in this.editables){this.destroyEditable(aj,ai);}}if(!ai){if(this.element.data("cke-widget-keep-attr")=="0"){this.element.removeAttribute("data-widget");}this.element.removeAttributes(["data-cke-widget-data","data-cke-widget-keep-attr"]);this.element.removeClass("cke_widget_element");this.element.replace(this.wrapper);}this.wrapper=null;},destroyEditable:function(ak,ai){var aj=this.editables[ak];aj.removeListener("focus",p);aj.removeListener("blur",q);this.editor.focusManager.remove(aj);if(!ai){aj.removeClass("cke_widget_editable");aj.removeClass("cke_widget_editable_focused");aj.removeAttributes(["contenteditable","data-cke-widget-editable","data-cke-enter-mode"]);}delete this.editables[ak];},edit:function(){var ai={dialog:this.dialog},aj=this;if(this.fire("edit",ai)===false||!ai.dialog){return false;}this.editor.openDialog(ai.dialog,function(am){var ak,al;if(aj.fire("dialog",am)===false){return;}ak=am.on("show",function(){am.setupContent(aj);});al=am.on("ok",function(){var ao,an=aj.on("data",function(ap){ao=1;ap.cancel();},null,null,0);aj.editor.fire("saveSnapshot");am.commitContent(aj);an.removeListener();if(ao){aj.fire("data",aj.data);aj.editor.fire("saveSnapshot");}});am.once("hide",function(){ak.removeListener();al.removeListener();});});return true;},getClasses:function(){return this.repository.parseElementClasses(this.element.getAttribute("class"));},hasClass:function(ai){return this.element.hasClass(ai);},initEditable:function(ak,aj){var ai=this.wrapper.findOne(aj.selector);if(ai&&ai.is(CKEDITOR.dtd.$editable)){ai=new k(this.editor,ai,{filter:f.call(this.repository,this.name,ak,aj)});this.editables[ak]=ai;ai.setAttributes({contenteditable:"true","data-cke-widget-editable":ak,"data-cke-enter-mode":ai.enterMode});if(ai.filter){ai.data("cke-filter",ai.filter.id);}ai.addClass("cke_widget_editable");ai.removeClass("cke_widget_editable_focused");if(aj.pathName){ai.data("cke-display-name",aj.pathName);}this.editor.focusManager.add(ai);ai.on("focus",p,this);CKEDITOR.env.ie&&ai.on("blur",q,this);ai.setData(ai.getHtml());return true;}return false;},isInited:function(){return !!(this.wrapper&&this.inited);},isReady:function(){return this.isInited()&&this.ready;},focus:function(){var aj=this.editor.getSelection();if(aj){var ai=this.editor.checkDirty();aj.fake(this.wrapper);!ai&&this.editor.resetDirty();}this.editor.focus();},removeClass:function(ai){this.element.removeClass(ai);},removeStyle:function(ai){m(this,ai,0);},setData:function(aj,am){var al=this.data,ai=0;if(typeof aj=="string"){if(al[aj]!==am){al[aj]=am;ai=1;}}else{var ak=aj;for(aj in ak){if(al[aj]!==ak[aj]){ai=1;al[aj]=ak[aj];}}}if(ai&&this.dataReady){ad(this);this.fire("data",al);}return this;},setFocused:function(ai){this.wrapper[ai?"addClass":"removeClass"]("cke_widget_focused");this.fire(ai?"focus":"blur");return this;},setSelected:function(ai){this.wrapper[ai?"addClass":"removeClass"]("cke_widget_selected");this.fire(ai?"select":"deselect");return this;},updateDragHandlerPosition:function(){var ak=this.editor,am=this.element.$,ai=this._.dragHandlerOffset,aj={x:am.offsetLeft,y:am.offsetTop-X};if(ai&&aj.x==ai.x&&aj.y==ai.y){return;}var al=ak.checkDirty();ak.fire("lockSnapshot");this.dragHandlerContainer.setStyles({top:aj.y+"px",left:aj.x+"px"});ak.fire("unlockSnapshot");!al&&ak.resetDirty();this._.dragHandlerOffset=aj;}};CKEDITOR.event.implementOn(h.prototype);function k(al,aj,ai){CKEDITOR.dom.element.call(this,aj.$);this.editor=al;var ak=this.filter=ai.filter;if(!CKEDITOR.dtd[this.getName()].p){this.enterMode=this.shiftEnterMode=CKEDITOR.ENTER_BR;}else{this.enterMode=ak?ak.getAllowedEnterMode(al.enterMode):al.enterMode;this.shiftEnterMode=ak?ak.getAllowedEnterMode(al.shiftEnterMode,true):al.shiftEnterMode;}}k.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.dom.element.prototype),{setData:function(ai){ai=this.editor.dataProcessor.toHtml(ai,{context:this.getName(),filter:this.filter,enterMode:this.enterMode});this.setHtml(ai);this.editor.widgets.initOnAll(this);},getData:function(){return this.editor.dataProcessor.toDataFormat(this.getHtml(),{context:this.getName(),filter:this.filter,enterMode:this.enterMode});}});function B(aj){var ai=aj.widgets.registered,al,ak,am;for(ak in ai){al=ai[ak];am=al.button;if(am&&aj.ui.addButton){aj.ui.addButton(CKEDITOR.tools.capitalize(al.name,true),{label:am,command:al.name,toolbar:"insert,10"});}}}function n(aj,ai){aj.addCommand(ai.name,{exec:function(){var aq=aj.widgets.focused;if(aq&&aq.name==ai.name){aq.edit();}else{if(ai.insert){ai.insert();}else{if(ai.template){var ap=typeof ai.defaults=="function"?ai.defaults():ai.defaults,an=CKEDITOR.dom.element.createFromHtml(ai.template.output(ap)),ak,ar=aj.widgets.wrapElement(an,ai.name),al=new CKEDITOR.dom.documentFragment(ar.getDocument());al.append(ar);ak=aj.widgets.initOn(an,ai);if(!ak){ao();return;}var am=ak.once("edit",function(at){if(at.data.dialog){ak.once("dialog",function(au){var aw=au.data,av,ax;av=aw.once("ok",ao,null,null,20);ax=aw.once("cancel",function(){aj.widgets.destroy(ak,true);});aw.once("hide",function(){av.removeListener();ax.removeListener();});});}else{ao();}},null,null,999);ak.edit();am.removeListener();}}}function ao(){aj.widgets.finalizeCreation(al);}},refresh:function(ak,al){this.setState(v(ak.editable(),al.blockLimit)?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF);},context:"div",allowedContent:ai.allowedContent,requiredContent:ai.requiredContent,contentForms:ai.contentForms,contentTransformations:ai.contentTransformations});}function t(ak,ai){var al=ai.upcast,aj;if(!al){return;}if(typeof al=="string"){aj=al.split(",");while(aj.length){ak._.upcasts.push([ai.upcasts[aj.pop()],ai.name]);}}else{ak._.upcasts.push([al,ai.name]);}}function ae(ai,ak){ai.focused=null;if(ak.isInited()){var aj=ak.editor.checkDirty();ai.fire("widgetBlurred",{widget:ak});ak.setFocused(false);!aj&&ak.editor.resetDirty();}}function W(ao){var ap=ao.data;if(this.editor.mode!="wysiwyg"){return;}var ak=this.editor.editable(),ai=this.instances,aq,al,am,aj;if(!ak){return;}for(al in ai){if(!ak.contains(ai[al].wrapper)){this.destroy(ai[al],true);}}if(ap&&ap.initOnlyNew){aq=this.initOnAll();}else{var an=ak.find(".cke_widget_wrapper");aq=[];for(al=0,am=an.count();al<am;al++){aj=an.getItem(al);if(!this.getByElement(aj,true)&&!D(aj,w)){aj.addClass("cke_widget_new");aq.push(this.initOn(aj.getFirst(r)));}}}if(ap&&ap.focusInited&&aq.length==1){aq[0].focus();}}function s(aj){var ai=aj.parent;if(ai.type==CKEDITOR.NODE_ELEMENT&&ai.attributes["data-cke-widget-wrapper"]){ai.replaceWith(aj);}}function F(am,aj){var an=aj.find(".cke_widget_wrapper"),ao,al,ak=0,ai=an.count();for(;ak<ai;++ak){ao=an.getItem(ak);al=ao.getFirst(r);if(al.type==CKEDITOR.NODE_ELEMENT&&al.data("widget")){al.replace(ao);am.wrapElement(al);}else{ao.remove();}}}function f(aj,am,al){if(!al.allowedContent){return null;}var ak=this._.filters[aj];if(!ak){this._.filters[aj]=ak={};}var ai=ak[am];if(!ai){ak[am]=ai=new CKEDITOR.filter(al.allowedContent);}return ai;}function e(aj){var al=[],ai=aj._.upcasts,ak=aj._.upcastCallbacks;return{toBeWrapped:al,iterator:function(ap){var at,aq,ar,ao,an,am;if("data-cke-widget-wrapper" in ap.attributes){ap=ap.getFirst(Y);if(ap){al.push([ap]);}return false;}else{if("data-widget" in ap.attributes){al.push([ap]);return false;}else{if((an=ai.length)){if(ap.attributes["data-cke-widget-upcasted"]){return false;}for(ao=0,am=ak.length;ao<am;++ao){if(ak[ao](ap)===false){return;}}for(ao=0;ao<an;++ao){at=ai[ao];ar={};if((aq=at[0](ap,ar))){if(aq instanceof CKEDITOR.htmlParser.element){ap=aq;}ap.attributes["data-cke-widget-data"]=encodeURIComponent(JSON.stringify(ar));ap.attributes["data-cke-widget-upcasted"]=1;al.push([ap,at[1]]);return false;}}}}}}};}function D(ai,ak){var aj=ai;while((aj=aj.getParent())){if(ak(aj)){return true;}}return false;}function v(aj,ai){if(!ai||ai.equals(aj)){return null;}if(b(ai)){return ai;}return v(aj,ai.getParent());}function G(ai){return{tabindex:-1,contenteditable:"false","data-cke-widget-wrapper":1,"data-cke-filter":"off","class":"cke_widget_wrapper cke_widget_new cke_widget_"+(ai?"inline":"block")};}function aa(al,aj,ak){if(al.type==CKEDITOR.NODE_ELEMENT){var an=CKEDITOR.dtd[al.name];if(an&&!an[ak.name]){var ai=al.split(aj),am=al.parent;aj=ai.getIndex();if(!al.children.length){aj-=1;al.remove();}if(!ai.children.length){ai.remove();}return aa(am,aj,ak);}}al.add(ak,aj);}function Y(ai){return ai.type==CKEDITOR.NODE_ELEMENT&&!!ai.attributes["data-widget"];}function r(ai){return ai.type==CKEDITOR.NODE_ELEMENT&&ai.hasAttribute("data-widget");}function I(aj,ai){return typeof aj.inline=="boolean"?aj.inline:!!CKEDITOR.dtd.$inline[ai];}function a(ai){return ai.type==CKEDITOR.NODE_ELEMENT&&ai.attributes["data-cke-widget-wrapper"];}function y(ai){return ai.type==CKEDITOR.NODE_ELEMENT&&ai.hasAttribute("data-cke-widget-wrapper");}function b(ai){return ai.type==CKEDITOR.NODE_ELEMENT&&ai.hasAttribute("data-cke-widget-editable");}function w(ai){return ai.hasAttribute("data-cke-temp");}function M(ai){return ai.type==CKEDITOR.NODE_ELEMENT&&ai.hasAttribute("data-cke-widget-drag-handler");}function c(ai){return ai.type==CKEDITOR.NODE_ELEMENT&&ai.hasClass("cke_widget_drag_handler_container");}function i(ak,aj,ai){aj.focus();ak.fire("saveSnapshot");ak.fire("lockSnapshot",{dontUpdate:true});ai.select();var al=aj.wrapper.getOuterHtml();aj.wrapper.remove();ak.widgets.destroy(aj,true);ak.execCommand("paste",al);ak.fire("unlockSnapshot");}function V(am,aj){var ak=aj.data.$,ao,ai=am.createRange();if(aj.data.testRange){return aj.data.testRange;}if(document.caretRangeFromPoint){ao=am.document.$.caretRangeFromPoint(ak.clientX,ak.clientY);ai.setStart(CKEDITOR.dom.node(ao.startContainer),ao.startOffset);ai.collapse(true);}else{if(ak.rangeParent){ai.setStart(CKEDITOR.dom.node(ak.rangeParent),ak.rangeOffset);ai.collapse(true);}else{if(document.body.createTextRange){ao=am.document.getBody().$.createTextRange();ao.moveToPoint(ak.clientX,ak.clientY);var an="cke-temp-"+(new Date()).getTime();ao.pasteHTML('<span id="'+an+'">\u200b</span>');var al=am.document.getById(an);ai.moveToPosition(al,CKEDITOR.POSITION_BEFORE_START);al.remove();}else{return null;}}}return ai;}function J(al,am){var an=al.focusedEditable,aj;if(am==CKEDITOR.CTRL+65){var ak=an.getBogus();aj=al.editor.createRange();aj.selectNodeContents(an);if(ak){aj.setEndAt(ak,CKEDITOR.POSITION_BEFORE_START);}aj.select();return false;}else{if(am==8||am==46){var ai=al.editor.getSelection().getRanges();aj=ai[0];return !(ai.length==1&&aj.collapsed&&aj.checkBoundaryOfElement(an,CKEDITOR[am==8?"START":"END"]));}}}function S(ak,al,am,ai){var aj=ak.editor;aj.fire("lockSnapshot");if(am){var ao=am.data("cke-widget-editable"),an=al.editables[ao];ak.widgetHoldingFocusedEditable=al;al.focusedEditable=an;am.addClass("cke_widget_editable_focused");if(an.filter){aj.setActiveFilter(an.filter);}aj.setActiveEnterMode(an.enterMode,an.shiftEnterMode);}else{if(!ai){al.focusedEditable.removeClass("cke_widget_editable_focused");}al.focusedEditable=null;ak.widgetHoldingFocusedEditable=null;aj.setActiveFilter(null);aj.setActiveEnterMode(null,null);}aj.fire("unlockSnapshot");}function R(ai){if(!ai.contextMenu){return;}ai.contextMenu.addListener(function(aj){var ak=ai.widgets.getByElement(aj,true);if(ak){return ak.fire("contextMenu",{});}});}var P=new RegExp('^(?:<(?:div|span)(?: data-cke-temp="1")?(?: id="cke_copybin")?(?: data-cke-temp="1")?>)?(?:<(?:div|span)(?: style="[^"]+")?>)?<span [^>]*data-cke-copybin-start="1"[^>]*>.?</span>([\\s\\S]+)<span [^>]*data-cke-copybin-end="1"[^>]*>.?</span>(?:</(?:div|span)>)?(?:</(?:div|span)>)?$');function E(ai,aj){return CKEDITOR.tools.trim(aj);}function Z(ak){var aj=ak.editor,ai=CKEDITOR.plugins.lineutils;aj.on("contentDom",function(){var al=aj.editable(),am=(CKEDITOR.env.ie&&CKEDITOR.env.version<9)||al.isInline()?al:aj.document;al.attachListener(am,"drop",function(an){var ar=an.data.$.dataTransfer.getData("text"),ap,aq,ao;if(!ar){return;}try{ap=JSON.parse(ar);}catch(at){return;}if(ap.type!="cke-widget"){return;}an.data.preventDefault();if(ap.editor!=aj.name||!(aq=ak.instances[ap.id])){return;}ao=V(aj,an);if(!ao){return;}if(CKEDITOR.env.gecko){setTimeout(i,0,aj,aq,ao);}else{i(aj,aq,ao);}});CKEDITOR.tools.extend(ak,{finder:new ai.finder(aj,{lookups:{"default":function(an){if(an.is(CKEDITOR.dtd.$listItem)){return;}if(!an.is(CKEDITOR.dtd.$block)){return;}while(an){if(b(an)){return;}an=an.getParent();}return CKEDITOR.LINEUTILS_BEFORE|CKEDITOR.LINEUTILS_AFTER;}}}),locator:new ai.locator(aj),liner:new ai.liner(aj,{lineStyle:{cursor:"move !important","border-top-color":"#666"},tipLeftStyle:{"border-left-color":"#666"},tipRightStyle:{"border-right-color":"#666"}})},true);});}function L(aj){var ai=aj.editor;ai.on("contentDom",function(){var ak=ai.editable(),al=ak.isInline()?ak:ai.document,am,an;ak.attachListener(al,"mousedown",function(ao){var ap=ao.data.getTarget();if(!ap.type){return false;}am=aj.getByElement(ap);an=0;if(am){if(am.inline&&ap.type==CKEDITOR.NODE_ELEMENT&&ap.hasAttribute("data-cke-widget-drag-handler")){an=1;return;}if(!v(am.wrapper,ap)){ao.data.preventDefault();if(!CKEDITOR.env.ie){am.focus();}}else{am=null;}}});ak.attachListener(al,"mouseup",function(){if(am&&an){an=0;am.focus();}});if(CKEDITOR.env.ie){ak.attachListener(al,"mouseup",function(){if(am){setTimeout(function(){am.focus();am=null;});}});}});ai.on("doubleclick",function(ak){var al=aj.getByElement(ak.data.element);if(!al||v(al.wrapper,ak.data.element)){return;}return al.fire("doubleclick",{element:ak.data.element});},null,null,1);}function ac(aj){var ai=aj.editor;ai.on("key",function(ak){var an=aj.focused,am=aj.widgetHoldingFocusedEditable,al;if(an){al=an.fire("key",{keyCode:ak.data.keyCode});}else{if(am){al=J(am,ak.data.keyCode);}}return al;},null,null,1);}function ag(ak){var aj=ak.editor;aj.on("contentDom",function(){var al=aj.editable();al.attachListener(al,"copy",ai);al.attachListener(al,"cut",ai);});function ai(al){if(ak.focused){O(ak.focused,al.name=="cut");}}}function Q(aj){var ai=aj.editor;ai.on("selectionCheck",function(){aj.fire("checkSelection");});aj.on("checkSelection",aj.checkSelection,aj);ai.on("selectionChange",function(al){var ak=v(ai.editable(),al.data.selection.getStartElement()),an=ak&&aj.getByElement(ak),am=aj.widgetHoldingFocusedEditable;if(am){if(am!==an||!am.focusedEditable.equals(ak)){S(aj,am,null);if(an&&ak){S(aj,an,ak);}}}else{if(an&&ak){S(aj,an,ak);}}});ai.on("dataReady",function(){af(aj).commit();});ai.on("blur",function(){var ak;if((ak=aj.focused)){ae(aj,ak);}if((ak=aj.widgetHoldingFocusedEditable)){S(aj,ak,null);}});}function o(ai){A(ai);d(ai);ai.on("checkWidgets",W);ai.editor.on("contentDomInvalidated",ai.checkWidgets,ai);}function d(aj){var ai=aj.editor,ak={};ai.on("toDataFormat",function(al){var an=CKEDITOR.tools.getNextNumber(),am=[];al.data.downcastingSessionId=an;ak[an]=am;al.data.dataValue.forEach(function(ap){var ao=ap.attributes,aq,ar;if("data-cke-widget-id" in ao){aq=aj.instances[ao["data-cke-widget-id"]];if(aq){ar=ap.getFirst(Y);am.push({wrapper:ap,element:ar,widget:aq,editables:{}});if(ar.attributes["data-cke-widget-keep-attr"]!="1"){delete ar.attributes["data-widget"];}}}else{if("data-cke-widget-editable" in ao){am[am.length-1].editables[ao["data-cke-widget-editable"]]=ap;return false;}}},CKEDITOR.NODE_ELEMENT,true);},null,null,8);ai.on("toDataFormat",function(al){if(!al.data.downcastingSessionId){return;}var am=ak[al.data.downcastingSessionId],aq,ao,at,an,ar,ap;while((aq=am.shift())){ao=aq.widget;at=aq.element;an=ao._.downcastFn&&ao._.downcastFn.call(ao,at);for(ap in aq.editables){ar=aq.editables[ap];delete ar.attributes.contenteditable;ar.setHtml(ao.editables[ap].getData());}if(!an){an=at;}aq.wrapper.replaceWith(an);}},null,null,13);ai.on("contentDomUnload",function(){aj.destroyAll(true);});}function A(al){var ak=al.editor,aj,am;ak.on("toHtml",function(an){var ap=e(al),ao;an.data.dataValue.forEach(ap.iterator,CKEDITOR.NODE_ELEMENT,true);while((ao=ap.toBeWrapped.pop())){s(ao[0]);al.wrapElement(ao[0],ao[1]);}aj=an.data.dataValue.children.length==1&&a(an.data.dataValue.children[0]);},null,null,8);ak.on("dataReady",function(){if(am){F(al,ak.editable());}am=0;al.destroyAll(true);al.initOnAll();});ak.on("loadSnapshot",function(an){if((/data-cke-widget/).test(an.data)){am=1;}al.destroyAll(true);},null,null,9);ak.on("paste",function(an){an.data.dataValue=an.data.dataValue.replace(P,E);});ak.on("insertText",ai,null,null,999);ak.on("insertHtml",ai,null,null,999);function ai(){ak.fire("lockSnapshot");al.checkWidgets({initOnlyNew:true,focusInited:aj});ak.fire("unlockSnapshot");}}function af(ak){var al=ak.selected,ai=[],aj=al.slice(0),am=null;return{select:function(ao){if(CKEDITOR.tools.indexOf(al,ao)<0){ai.push(ao);}var an=CKEDITOR.tools.indexOf(aj,ao);if(an>=0){aj.splice(an,1);}return this;},focus:function(an){am=an;return this;},commit:function(){var an=ak.focused!==am,ap,ao;ak.editor.fire("lockSnapshot");if(an&&(ap=ak.focused)){ae(ak,ap);}while((ap=aj.pop())){al.splice(CKEDITOR.tools.indexOf(al,ap),1);if(ap.isInited()){ao=ap.editor.checkDirty();ap.setSelected(false);!ao&&ap.editor.resetDirty();}}if(an&&am){ao=ak.editor.checkDirty();ak.focused=am;ak.fire("widgetFocused",{widget:am});am.setFocused(true);!ao&&ak.editor.resetDirty();}while((ap=ai.pop())){al.push(ap);ap.setSelected(true);}ak.editor.fire("unlockSnapshot");}};}var H={37:1,38:1,39:1,40:1,8:1,46:1};function m(an,am,aj){var ao=0,al=z(am),ak=an.data.classes||{},ai;if(!al){return;}ak=CKEDITOR.tools.clone(ak);while((ai=al.pop())){if(aj){if(!ak[ai]){ao=ak[ai]=1;}}else{if(ak[ai]){delete ak[ai];ao=1;}}}if(ao){an.setData("classes",ak);}}function j(ai){ai.cancel();}function O(al,at){var aq=al.editor,au=aq.document;if(au.getById("cke_copybin")){return;}var ap=(aq.blockless||CKEDITOR.env.ie)?"span":"div",am=au.createElement(ap),ar=au.createElement(ap),av=CKEDITOR.env.ie&&CKEDITOR.env.version<9;ar.setAttributes({id:"cke_copybin","data-cke-temp":"1"});am.setStyles({position:"absolute",width:"1px",height:"1px",overflow:"hidden"});am.setStyle(aq.config.contentsLangDirection=="ltr"?"left":"right","-5000px");am.setHtml('<span data-cke-copybin-start="1">\u200b</span>'+al.wrapper.getOuterHtml()+'<span data-cke-copybin-end="1">\u200b</span>');aq.fire("saveSnapshot");aq.fire("lockSnapshot");ar.append(am);aq.editable().append(ar);var ao=aq.on("selectionChange",j,null,null,0),an=al.repository.on("checkSelection",j,null,null,0);if(av){var aj=au.getDocumentElement().$,ai=aj.scrollTop;}var ak=aq.createRange();ak.selectNodeContents(am);ak.select();if(av){aj.scrollTop=ai;}setTimeout(function(){if(!at){al.focus();}ar.remove();ao.removeListener();an.removeListener();aq.fire("unlockSnapshot");if(at){al.repository.del(al);aq.fire("saveSnapshot");}},100);}function z(ak){var ai=ak.getDefinition().attributes,aj=ai&&ai["class"];return aj?aj.split(/\s+/):null;}function q(){var ak=CKEDITOR.document.getActive(),aj=this.editor,ai=aj.editable();if((ai.isInline()?ai:aj.document.getWindow().getFrame()).equals(ak)){aj.focusManager.focus(ai);}}function p(){if(CKEDITOR.env.gecko){this.editor.unlockSelection();}if(!CKEDITOR.env.webkit){this.editor.forceNextSelectionCheck();this.editor.selectionChange(1);}}function K(aj){var ai=null;aj.on("data",function(){var al=this.data.classes,ak;if(ai==al){return;}for(ak in ai){if(!(al&&al[ak])){this.removeClass(ak);}}for(ak in al){this.addClass(ak);}ai=al;});}function C(al){if(!al.draggable){return;}var ak=al.editor,ai=al.wrapper.getLast(c),aj;if(ai){aj=ai.findOne("img");}else{ai=new CKEDITOR.dom.element("span",ak.document);ai.setAttributes({"class":"cke_reset cke_widget_drag_handler_container",style:"background:rgba(220,220,220,0.5);background-image:url("+ak.plugins.widget.path+"images/handle.png)"});aj=new CKEDITOR.dom.element("img",ak.document);aj.setAttributes({"class":"cke_reset cke_widget_drag_handler","data-cke-widget-drag-handler":"1",src:CKEDITOR.tools.transparentImageData,width:X,title:ak.lang.widget.move,height:X});al.inline&&aj.setAttribute("draggable","true");ai.append(aj);al.wrapper.append(ai);}al.wrapper.on("mouseenter",al.updateDragHandlerPosition,al);setTimeout(function(){al.on("data",al.updateDragHandlerPosition,al);},50);if(al.inline){aj.on("dragstart",function(am){am.data.$.dataTransfer.setData("text",JSON.stringify({type:"cke-widget",editor:ak.name,id:al.id}));});}else{aj.on("mousedown",x,al);}al.dragHandlerContainer=ai;}function x(){var aj=this.repository.finder,am=this.repository.locator,ai=this.repository.liner,ao=this.editor,ak=ao.editable(),ar=[],ap=[],au=aj.greedySearch(),al=CKEDITOR.tools.eventsBuffer(50,function(){aq=am.locate(au);ap=am.sort(at,1);if(ap.length){ai.prepare(au,aq);ai.placeLine(ap[0]);ai.cleanup();}}),aq,at;ak.addClass("cke_widget_dragging");ar.push(ak.on("mousemove",function(av){at=av.data.$.clientY;al.input();}));function an(){var av;al.reset();while((av=ar.pop())){av.removeListener();}U.call(this,ap);}ar.push(ao.document.once("mouseup",an,this));ar.push(CKEDITOR.document.once("mouseup",an,this));}function U(ak){var an=this.repository.finder,aj=this.repository.liner,am=this.editor,al=this.editor.editable();if(!CKEDITOR.tools.isEmpty(aj.visible)){var ai=an.getRange(ak[0]);this.focus();am.fire("saveSnapshot");am.fire("lockSnapshot",{dontUpdate:1});am.getSelection().reset();al.insertElementIntoRange(this.wrapper,ai);this.focus();am.fire("unlockSnapshot");am.fire("saveSnapshot");}al.removeClass("cke_widget_dragging");aj.hideVisible();}function ab(ak){var al,aj,ai=ak.editables;ak.editables={};if(!ak.editables){return;}for(al in ai){aj=ai[al];ak.initEditable(al,typeof aj=="string"?{selector:aj}:aj);}}function N(aj){if(!aj.mask){return;}var ai=aj.wrapper.findOne(".cke_widget_mask");if(!ai){ai=new CKEDITOR.dom.element("img",aj.editor.document);ai.setAttributes({src:CKEDITOR.tools.transparentImageData,"class":"cke_reset cke_widget_mask"});aj.wrapper.append(ai);}aj.mask=ai;}function T(ak){if(ak.parts){var al={},aj,ai;for(ai in ak.parts){aj=ak.wrapper.findOne(ak.parts[ai]);al[ai]=aj;}ak.parts=al;}}function l(aj,ai){g(aj);T(aj);ab(aj);N(aj);C(aj);K(aj);if(CKEDITOR.env.ie&&CKEDITOR.env.version<9){aj.wrapper.on("dragstart",function(ak){var al=ak.data.getTarget();if(!v(aj,al)&&!(aj.inline&&M(al))){ak.data.preventDefault();}});}aj.wrapper.removeClass("cke_widget_new");aj.element.addClass("cke_widget_element");aj.on("key",function(ak){var al=ak.data.keyCode;if(al==13){aj.edit();}else{if(al==CKEDITOR.CTRL+67||al==CKEDITOR.CTRL+88){O(aj,al==CKEDITOR.CTRL+88);return;}else{if(al in H||(CKEDITOR.CTRL&al)||(CKEDITOR.ALT&al)){return;}}}return false;},null,null,999);aj.on("doubleclick",function(ak){if(aj.edit()){ak.cancel();}});if(ai.data){aj.on("data",ai.data);}if(ai.edit){aj.on("edit",ai.edit);}}function u(aj,ai){var ak=aj.element.data("cke-widget-data");if(ak){aj.setData(JSON.parse(decodeURIComponent(ak)));}if(ai){aj.setData(ai);}if(!aj.data.classes){aj.setData("classes",aj.getClasses());}aj.dataReady=true;ad(aj);aj.fire("data",aj.data);}function g(ai){var aj=ai.wrapper=ai.element.getParent();aj.setAttribute("data-cke-widget-id",ai.id);}function ad(ai){ai.element.data("cke-widget-data",encodeURIComponent(JSON.stringify(ai.data)));}(function(){CKEDITOR.style.addCustomHandler({type:"widget",setup:function(ak){this.widget=ak.widget;},apply:function(ak){if(!(ak instanceof CKEDITOR.editor)){return;}if(this.checkApplicable(ak.elementPath(),ak)){ak.widgets.focused.applyStyle(this);}},remove:function(ak){if(!(ak instanceof CKEDITOR.editor)){return;}if(this.checkApplicable(ak.elementPath(),ak)){ak.widgets.focused.removeStyle(this);}},checkActive:function(al,ak){return this.checkElementMatch(al.lastElement,0,ak);},checkApplicable:function(al,ak){if(!(ak instanceof CKEDITOR.editor)){return false;}return this.checkElement(al.lastElement);},checkElementMatch:ai,checkElementRemovable:ai,checkElement:function(ak){if(!y(ak)){return false;}var al=ak.getFirst(r);return al&&al.data("widget")==this.widget;},buildPreview:function(ak){return ak||this._.definition.name;},toAllowedContentRules:function(am){if(!am){return null;}var ak=am.widgets.registered[this.widget],al,an={};if(!ak){return null;}if(ak.styleableElements){al=this.getClassesArray();if(!al){return null;}an[ak.styleableElements]={classes:al,propertiesOnly:true};return an;}if(ak.styleToAllowedContentRules){return ak.styleToAllowedContentRules(this);}return null;},getClassesArray:function(){var ak=this._.definition.attributes&&this._.definition.attributes["class"];return ak?CKEDITOR.tools.trim(ak).split(/\s+/):null;},applyToRange:aj,removeFromRange:aj,applyToObject:aj});function aj(){}function ai(ak,an,al){if(!al){return false;}if(!this.checkElement(ak)){return false;}var am=al.widgets.getByElement(ak,true);return am&&am.checkStyleActive(this);}})();CKEDITOR.plugins.widget=h;h.repository=ah;h.nestedEditable=k;})();