(function(a){typeof exports=="object"&&typeof module=="object"?a(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror);})(function(c){function b(h,f,e){var d=h.getWrapperElement(),g;return g=d.appendChild(document.createElement("div")),g.className=e?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top",typeof f=="string"?g.innerHTML=f:g.appendChild(f),g;}function a(e,d){e.state.currentNotificationClose&&e.state.currentNotificationClose(),e.state.currentNotificationClose=d;}c.defineExtension("openDialog",function(d,p,k){function g(){n||(n=!0,q.parentNode.removeChild(q));}var m,j;a(this,null);var q=b(this,d,k&&k.bottom),n=!1,i=this;if(m=q.getElementsByTagName("input")[0],m){k&&k.value&&(m.value=k.value);c.on(m,"keydown",function(e){k&&k.onKeyDown&&k.onKeyDown(e,m.value,g)||(e.keyCode==13||e.keyCode==27)&&(m.blur(),c.e_stop(e),g(),i.focus(),e.keyCode==13&&p(m.value));});if(k&&k.onKeyUp){c.on(m,"keyup",function(e){k.onKeyUp(e,m.value,g);});}k&&k.value&&(m.value=k.value),m.focus();c.on(m,"blur",g);}else{if(j=q.getElementsByTagName("button")[0]){c.on(j,"click",function(){g(),i.focus();});j.focus();c.on(j,"blur",g);}}return g;}),c.defineExtension("openConfirm",function(d,t,k){function q(){i||(i=!0,w.parentNode.removeChild(w),p.focus());}var m,g;a(this,null);var w=b(this,d,k&&k.bottom),j=w.getElementsByTagName("button"),i=!1,p=this,n=1;for(j[0].focus(),m=0;m<j.length;++m){g=j[m],function(e){c.on(g,"click",function(f){c.e_preventDefault(f),q(),e&&e(p);});}(t[m]);c.on(g,"blur",function(){--n,setTimeout(function(){n<=0&&q();},200);});c.on(g,"focus",function(){++n;});}}),c.defineExtension("openNotification",function(j,d){function l(){m||(m=!0,clearTimeout(g),k.parentNode.removeChild(k));}a(this,l);var k=b(this,j,d&&d.bottom),i=d&&(d.duration===undefined?5000:d.duration),m=!1,g;c.on(k,"click",function(e){c.e_preventDefault(e),l();});i&&(g=setTimeout(l,d.duration));});}),function(a){typeof exports=="object"&&typeof module=="object"?a(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],a):a(CodeMirror);}(function(j){function A(c,a){return typeof c=="string"?c=new RegExp(c.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),a?"gi":"g"):c.global||(c=new RegExp(c.source,c.ignoreCase?"gi":"g")),{token:function(f){c.lastIndex=f.pos;var e=c.exec(f.string);if(e&&e.index==f.pos){return f.pos+=e[0].length,"searching";}e?f.pos=e.index:f.skipToEnd();}};}function k(){this.posFrom=this.posTo=this.query=null,this.overlay=null;}function m(a){return a.state.search||(a.state.search=new k);}function b(a){return typeof a=="string"&&a==a.toLowerCase();}function G(e,c,a){return e.getSearchCursor(c,a,b(c));}function F(h,e,c,f,a){h.openDialog?h.openDialog(e,a,{value:f}):a(prompt(c,f));}function C(f,c,a,e){f.openConfirm?f.openConfirm(c,e):confirm(a)&&e[0]();}function g(c){var a=c.match(/^\/(.*)\/([a-z]*)$/);return a?(c=new RegExp(a[1],a[2].indexOf("i")==-1?"":"i"),c.test("")&&(c=/x^/)):c==""&&(c=/x^/),c;}function x(e,a){var c=m(e);if(c.query){return H(e,a);}F(e,E,"Search for:",e.getSelection(),function(f){e.operation(function(){f&&!c.query&&(c.query=g(f),e.removeOverlay(c.overlay,b(c.query)),c.overlay=A(c.query,b(c.query)),e.addOverlay(c.overlay),c.posFrom=c.posTo=e.getCursor(),H(e,a));});});}function H(c,a){c.operation(function(){var i=m(c),h=G(c,i.query,a?i.posFrom:i.posTo);(h.find(a)||(h=G(c,i.query,a?j.Pos(c.lastLine()):j.Pos(c.firstLine(),0)),h.find(a)))&&(c.setSelection(h.from(),h.to()),c.scrollIntoView({from:h.from(),to:h.to()}),i.posFrom=h.from(),i.posTo=h.to());});}function z(a){a.operation(function(){var c=m(a);c.query&&(c.query=null,a.removeOverlay(c.overlay));});}function q(c,a){F(c,B,"Replace:",c.getSelection(),function(e){e&&(e=g(e),F(c,d,"Replace with:","",function(h){if(a){c.operation(function(){for(var p,o=G(c,e);o.findNext();){typeof e!="string"?(p=c.getRange(o.from(),o.to()).match(e),o.replace(h.replace(/\$(\d)/g,function(r,f){return p[f];}))):o.replace(h);}});}else{z(c);var l=G(c,e,c.getCursor()),n=function(){var o=l.from(),f;((f=l.findNext())||(l=G(c,e),(f=l.findNext())&&(!o||l.from().line!=o.line||l.from().ch!=o.ch)))&&(c.setSelection(l.from(),l.to()),c.scrollIntoView({from:l.from(),to:l.to()}),C(c,D,"Replace?",[function(){i(f);},n]));},i=function(f){l.replace(typeof e=="string"?h:h.replace(/\$(\d)/g,function(p,o){return f[o];})),n();};n();}}));});}var E='Search: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',B='Replace: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',d='With: <input type="text" style="width: 10em"/>',D="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";j.commands.find=function(a){z(a),x(a);},j.commands.findNext=x,j.commands.findPrev=function(a){x(a,!0);},j.commands.clearSearch=z,j.commands.replace=q,j.commands.replaceAll=function(a){q(a,!0);};}),function(a){typeof exports=="object"&&typeof module=="object"?a(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror);}(function(d){function b(r,j,g,m){var l,q,p,k;this.atOccurrence=!1,this.doc=r,m==null&&typeof j=="string"&&(m=!1),g=g?r.clipPos(g):a(0,0),this.pos={from:g,to:g},typeof j!="string"?(j.global||(j=new RegExp(j.source,j.ignoreCase?"ig":"g")),this.matches=function(v,i){var y,t,w,n,z,x;if(v){for(j.lastIndex=0,y=r.getLine(i.line).slice(0,i.ch),t=0;;){if(j.lastIndex=t,z=j.exec(y),!z){break;}if(w=z,n=w.index,t=w.index+(w[0].length||1),t==y.length){break;}}x=w&&w[0].length||0,x||(n==0&&y.length==0?w=undefined:n!=r.getLine(i.line).length&&x++);}else{j.lastIndex=i.ch;var y=r.getLine(i.line),w=j.exec(y),x=w&&w[0].length||0,n=w&&w.index;n+x==y.length||x||(x=1);}if(w&&x){return{from:a(i.line,n),to:a(i.line,n+x),match:w};}}):(l=j,m&&(j=j.toLowerCase()),q=m?function(e){return e.toLowerCase();}:function(e){return e;},p=j.split("\n"),p.length==1?this.matches=j.length?function(h,n){if(h){var i=r.getLine(n.line).slice(0,n.ch),t=q(i),o=t.lastIndexOf(j);if(o>-1){return o=c(i,t,o),{from:a(n.line,o),to:a(n.line,o+l.length)};}}else{var i=r.getLine(n.line).slice(n.ch),t=q(i),o=t.indexOf(j);if(o>-1){return o=c(i,t,o)+n.ch,{from:a(n.line,o),to:a(n.line,o+l.length)};}}}:function(){}:(k=l.split("\n"),this.matches=function(o,e){var s=p.length-1,x,w,n,y,z,t;if(o){if(e.line-(p.length-1)<r.firstLine()){return;}if(q(r.getLine(e.line).slice(0,k[s].length))!=p[p.length-1]){return;}for(x=a(e.line,k[s].length),z=e.line-1,t=s-1;t>=1;--t,--z){if(p[t]!=q(r.getLine(z))){return;}}return(w=r.getLine(z),n=w.length-k[0].length,q(w.slice(n))!=p[0])?void 0:{from:a(z,n),to:x};}if(!(e.line+(p.length-1)>r.lastLine())&&(w=r.getLine(e.line),n=w.length-k[0].length,q(w.slice(n))==p[0])){for(y=a(e.line,n),z=e.line+1,t=1;t<s;++t,++z){if(p[t]!=q(r.getLine(z))){return;}}if(r.getLine(z).slice(0,k[s].length)==p[s]){return{from:y,to:a(z,k[s].length)};}}}));}function c(j,g,f){var h,e;if(j.length==g.length){return f;}for(h=Math.min(f,j.length);;){if(e=j.slice(0,h).toLowerCase().length,e<f){++h;}else{if(e>f){--h;}else{return h;}}}}var a=d.Pos;b.prototype={findNext:function(){return this.find(!1);},findPrevious:function(){return this.find(!0);},find:function(k){function j(l){var f=a(l,0);return e.pos={from:f,to:f},e.atOccurrence=!1,!1;}for(var e=this,g=this.doc.clipPos(k?this.pos.from:this.pos.to),h;;){if(this.pos=this.matches(k,g)){return this.atOccurrence=!0,this.pos.match||!0;}if(k){if(!g.line){return j(0);}g=a(g.line-1,this.doc.getLine(g.line-1).length);}else{if(h=this.doc.lineCount(),g.line==h-1){return j(h);}g=a(g.line+1,0);}}},from:function(){if(this.atOccurrence){return this.pos.from;}},to:function(){if(this.atOccurrence){return this.pos.to;}},replace:function(e){if(this.atOccurrence){var f=d.splitLines(e);this.doc.replaceRange(f,this.pos.from,this.pos.to),this.pos.to=a(this.pos.from.line+f.length-1,f[f.length-1].length+(f.length==1?this.pos.from.ch:0));}}},d.defineExtension("getSearchCursor",function(g,e,f){return new b(this.doc,g,e,f);}),d.defineDocExtension("getSearchCursor",function(g,e,f){return new b(this,g,e,f);}),d.defineExtension("selectMatches",function(h,g){for(var e=[],k,j=this.getSearchCursor(h,this.getCursor("from"),g);k=j.findNext();){if(d.cmpPos(j.to(),this.getCursor("to"))>0){break;}e.push({anchor:j.from(),head:j.to()});}e.length&&this.setSelections(e,0);});});