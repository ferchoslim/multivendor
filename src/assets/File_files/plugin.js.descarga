(function(a){CKEDITOR.plugins.add("codemirror",{icons:"searchcode,autoformat,commentselectedrange,uncommentselectedrange,autocomplete",lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en-au,en-ca,en-gb,en,eo,es,et,eu,fa,fi,fo,fr-ca,fr,gl,gu,he,hi,hr,hu,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt-br,pt,ro,ru,sk,sl,sr-latn,sr,sv,th,tr,ug,uk,vi,zh-cn,zh",version:1.11,init:function(g){var f=this.path,c={autoCloseBrackets:true,autoCloseTags:true,autoFormatOnStart:false,autoFormatOnUncomment:true,continueComments:true,enableCodeFolding:true,enableCodeFormatting:true,enableSearchTools:true,highlightActiveLine:true,highlightMatches:true,indentWithTabs:false,lineNumbers:true,lineWrapping:true,mode:"htmlmixed",matchBrackets:true,matchTags:true,showAutoCompleteButton:true,showCommentButton:true,showFormatButton:true,showSearchButton:true,showTrailingSpace:true,showUncommentButton:true,theme:"default",useBeautify:false};var e=CKEDITOR.tools.extend(c,g.config.codemirror||{},true),j=g.lang.codemirror;if(g.config.codemirror_theme){e.theme=g.config.codemirror_theme;}if(g.config.codemirror_autoFormatOnStart){e.autoFormatOnStart=g.config.codemirror_autoFormatOnStart;}if(g.plugins.bbcode&&e.mode.indexOf("bbcode")<=0){e.mode="bbcode";}if(g.elementMode===CKEDITOR.ELEMENT_MODE_INLINE){CKEDITOR.dialog.add("sourcedialog",function(p){var n=CKEDITOR.document.getWindow().getViewPaneSize(),o=Math.min(n.width-70,800),l=n.height/1.5,q;function m(v,y){var t;window["codemirror_"+v.id]=CodeMirror.fromTextArea(y,{mode:e.mode,matchBrackets:e.matchBrackets,matchTags:e.matchTags,workDelay:300,workTime:35,readOnly:v.config.readOnly,lineNumbers:e.lineNumbers,lineWrapping:e.lineWrapping,autoCloseTags:e.autoCloseTags,autoCloseBrackets:e.autoCloseBrackets,highligctionMatches:e.highlightMatches,continueComments:e.continueComments,indentWithTabs:e.indentWithTabs,theme:e.theme,showTrailingSpace:e.showTrailingSpace,showCursorWhenSelecting:true,viewportMargin:Infinity,extraKeys:{"Ctrl-Q":function(B){window["foldFunc_"+v.id](B,B.getCursor().line);}},onKeyEvent:function(D,B){if(e.enableCodeFormatting){var C=A();if(B.type==="keydown"&&B.ctrlKey&&B.keyCode===75&&!B.shiftKey&&!B.altKey){window["codemirror_"+v.id].commentRange(true,C.from,C.to);}else{if(B.type==="keydown"&&B.ctrlKey&&B.keyCode===75&&B.shiftKey&&!B.altKey){window["codemirror_"+v.id].commentRange(false,C.from,C.to);if(e.autoFormatOnUncomment){window["codemirror_"+v.id].autoFormatRange(C.from,C.to);}}else{if(B.type==="keydown"&&B.ctrlKey&&B.keyCode===75&&!B.shiftKey&&B.altKey){window["codemirror_"+v.id].autoFormatRange(C.from,C.to);}}}}}});var u=l+"px";var z=o+"px";window["codemirror_"+v.id].config=e;if(e.autoFormatOnStart){if(e.useBeautify){var w=4,x=" ",s="collapse";var r=window["codemirror_"+v.id].getValue();window["codemirror_"+v.id].setValue(html_beautify(r,w,x,120,s));}else{window["codemirror_"+v.id].autoFormatAll({line:0,ch:0},{line:window["codemirror_"+v.id].lineCount(),ch:0});}}function A(){return{from:window["codemirror_"+v.id].getCursor(true),to:window["codemirror_"+v.id].getCursor(false)};}window["codemirror_"+v.id].on("change",function(){clearTimeout(t);t=setTimeout(function(){var B=window["codemirror_"+v.id];if(B){B.save();}},300);});window["codemirror_"+v.id].setSize(z,u);if(e.lineNumbers&&e.enableCodeFolding){window["codemirror_"+v.id].on("gutterClick",window["foldFunc_"+v.id]);}if(e.highlightActiveLine){window["codemirror_"+v.id].hlLine=window["codemirror_"+v.id].addLineClass(0,"background","activeline");window["codemirror_"+v.id].on("cursorActivity",function(){var B=window["codemirror_"+v.id].getLineHandle(window["codemirror_"+v.id].getCursor().line);if(B!=window["codemirror_"+v.id].hlLine){window["codemirror_"+v.id].removeLineClass(window["codemirror_"+v.id].hlLine,"background","activeline");window["codemirror_"+v.id].hlLine=window["codemirror_"+v.id].addLineClass(B,"background","activeline");}});}if(typeof e.onLoad==="function"){e.onLoad(window["codemirror_"+v.id],v);}}return{title:p.lang.sourcedialog.title,minWidth:o,minHeight:l,resizable:CKEDITOR.DIALOG_RESIZE_NONE,onShow:function(){this.getContentElement("main","data").focus();this.getContentElement("main","AutoComplete").setValue(e.autoCloseTags,true);var r=this.getContentElement("main","data").getInputElement().$;this.setValueOf("main","data",q=p.getData());if(typeof(CodeMirror)=="undefined"){CKEDITOR.document.appendStyleSheet(f+"css/codemirror.min.css");if(e.theme.length&&e.theme!="default"){CKEDITOR.document.appendStyleSheet(f+"theme/"+e.theme+".css");}CKEDITOR.scriptLoader.load(f+"js/codemirror.min.js",function(){CKEDITOR.scriptLoader.load(d(),function(){m(p,r);});});}else{m(p,r);}},onCancel:function(r){if(r.data.hide){window["codemirror_"+p.id].toTextArea();window["codemirror_"+p.id]=null;}},onOk:(function(){function r(s){var t=this;p.setData(s,function(){t.hide();var u=p.createRange();u.moveToElementEditStart(p.editable());u.select();});}return function(){window["codemirror_"+p.id].toTextArea();window["codemirror_"+p.id]=null;var s=this.getValueOf("main","data").replace(/\r/g,"");if(s===q){return true;}CKEDITOR.env.ie?CKEDITOR.tools.setTimeout(r,0,this,s):r.call(this,s);return false;};})(),contents:[{id:"main",label:p.lang.sourcedialog.title,elements:[{type:"hbox",style:"width: 80px;margin:0;",widths:["20px","20px","20px","20px"],children:[{type:"button",id:"searchCode",label:"",title:j.searchCode,"class":"searchCodeButton",onClick:function(){CodeMirror.commands.find(window["codemirror_"+p.id]);}},{type:"button",id:"autoFormat",label:"",title:j.autoFormat,"class":"autoFormat",onClick:function(){var r={from:window["codemirror_"+p.id].getCursor(true),to:window["codemirror_"+p.id].getCursor(false)};window["codemirror_"+p.id].autoFormatRange(r.from,r.to);}},{type:"button",id:"CommentSelectedRange",label:"",title:j.commentSelectedRange,"class":"CommentSelectedRange",onClick:function(){var r={from:window["codemirror_"+p.id].getCursor(true),to:window["codemirror_"+p.id].getCursor(false)};window["codemirror_"+p.id].commentRange(true,r.from,r.to);}},{type:"button",id:"UncommentSelectedRange",label:"",title:j.uncommentSelectedRange,"class":"UncommentSelectedRange",onClick:function(){var r={from:window["codemirror_"+p.id].getCursor(true),to:window["codemirror_"+p.id].getCursor(false)};window["codemirror_"+p.id].commentRange(false,r.from,r.to);if(window["codemirror_"+p.id].config.autoFormatOnUncomment){window["codemirror_"+p.id].autoFormatRange(r.from,r.to);}}}]},{type:"checkbox",id:"AutoComplete",label:j.autoCompleteToggle,title:j.autoCompleteToggle,onChange:function(){window["codemirror_"+p.id].setOption("autoCloseTags",this.getValue());}},{type:"textarea",id:"data",dir:"ltr",inputStyle:"cursor:auto;width:"+o+"px;height:"+l+"px;tab-size:4;text-align:left;","class":"cke_source cke_enable_context_menu"}]}]};});return;}if(g.commands.find){g.commands.find.modes={wysiwyg:1,source:1};g.commands.find.exec=function(){if(g.mode==="wysiwyg"){g.openDialog("find");}else{CodeMirror.commands.find(window["codemirror_"+g.id]);}};}if(g.commands.replace){g.commands.replace.modes={wysiwyg:1,source:1};g.commands.replace.exec=function(){if(g.mode==="wysiwyg"){g.openDialog("replace");}else{CodeMirror.commands.replace(window["codemirror_"+g.id]);}};}var h=CKEDITOR.plugins.sourcearea;if(!h.commands.searchCode){CKEDITOR.plugins.sourcearea.commands={source:{modes:{wysiwyg:1,source:1},editorFocus:false,readOnly:1,exec:function(l){if(l.mode==="wysiwyg"){l.fire("saveSnapshot");}l.getCommand("source").setState(CKEDITOR.TRISTATE_DISABLED);l.setMode(l.mode==="source"?"wysiwyg":"source");},canUndo:false},searchCode:{modes:{wysiwyg:0,source:1},editorFocus:false,readOnly:1,exec:function(l){CodeMirror.commands.find(window["codemirror_"+l.id]);},canUndo:true},autoFormat:{modes:{wysiwyg:0,source:1},editorFocus:false,readOnly:1,exec:function(m){var l={from:window["codemirror_"+m.id].getCursor(true),to:window["codemirror_"+m.id].getCursor(false)};window["codemirror_"+m.id].autoFormatRange(l.from,l.to);},canUndo:true},commentSelectedRange:{modes:{wysiwyg:0,source:1},editorFocus:false,readOnly:1,exec:function(m){var l={from:window["codemirror_"+m.id].getCursor(true),to:window["codemirror_"+m.id].getCursor(false)};window["codemirror_"+m.id].commentRange(true,l.from,l.to);},canUndo:true},uncommentSelectedRange:{modes:{wysiwyg:0,source:1},editorFocus:false,readOnly:1,exec:function(m){var l={from:window["codemirror_"+m.id].getCursor(true),to:window["codemirror_"+m.id].getCursor(false)};window["codemirror_"+m.id].commentRange(false,l.from,l.to);if(window["codemirror_"+m.id].config.autoFormatOnUncomment){window["codemirror_"+m.id].autoFormatRange(l.from,l.to);}},canUndo:true},autoCompleteToggle:{modes:{wysiwyg:0,source:1},editorFocus:false,readOnly:1,exec:function(l){if(this.state==CKEDITOR.TRISTATE_ON){window["codemirror_"+l.id].setOption("autoCloseTags",false);}else{if(this.state==CKEDITOR.TRISTATE_OFF){window["codemirror_"+l.id].setOption("autoCloseTags",true);}}this.toggleState();},canUndo:true}};}g.addMode("source",function(l){if(typeof(CodeMirror)=="undefined"){CKEDITOR.document.appendStyleSheet(f+"css/codemirror.min.css");if(e.theme.length&&e.theme!="default"){CKEDITOR.document.appendStyleSheet(f+"theme/"+e.theme+".css");}CKEDITOR.scriptLoader.load(f+"js/codemirror.min.js",function(){CKEDITOR.scriptLoader.load(d(),function(){k(g);l();});});}else{k(g);l();}});function d(){var l=[f+"js/codemirror.addons.min.js"];switch(e.mode){case"bbcode":l.push(f+"js/codemirror.mode.bbcode.min.js");break;case"bbcodemixed":l.push(f+"js/codemirror.mode.bbcodemixed.min.js");break;case"htmlmixed":l.push(f+"js/codemirror.mode.htmlmixed.min.js");break;case"text/html":l.push(f+"js/codemirror.mode.htmlmixed.min.js");break;case"application/x-httpd-php":l.push(f+"js/codemirror.mode.php.min.js");break;case"text/javascript":l.push(f+"js/codemirror.mode.javascript.min.js");break;default:l.push(f+"js/codemirror.mode.htmlmixed.min.js");}if(e.useBeautify){l.push(f+"js/beautify.min.js");}if(e.enableSearchTools){l.push(f+"js/codemirror.addons.search.min.js");}return l;}function k(q){var y=q.ui.space("contents"),v=y.getDocument().createElement("textarea");v.setStyles(CKEDITOR.tools.extend({width:CKEDITOR.env.ie7Compat?"99%":"100%",height:"100%",resize:"none",outline:"none","text-align":"left"},CKEDITOR.tools.cssVendorPrefix("tab-size",q.config.sourceAreaTabSize||4)));var t=[q.lang.editor,q.name].join(",");v.setAttributes({dir:"ltr",tabIndex:CKEDITOR.env.webkit?-1:q.tabIndex,role:"textbox","aria-label":t});v.addClass("cke_source cke_reset cke_enable_context_menu");q.ui.space("contents").append(v);window["editable_"+q.id]=q.editable(new b(q,v));window["editable_"+q.id].setData(q.getData(1));window["editable_"+q.id].editorID=q.id;q.fire("ariaWidget",this);var o;var s=window["editable_"+q.id],m=s.getParent();if(e.lineNumbers&&e.enableCodeFolding){window["foldFunc_"+q.id]=CodeMirror.newFoldFunction(CodeMirror.tagRangeFinder);}window["codemirror_"+q.id]=CodeMirror.fromTextArea(s.$,{mode:e.mode,matchBrackets:e.matchBrackets,matchTags:e.matchTags,workDelay:300,workTime:35,readOnly:q.config.readOnly,lineNumbers:e.lineNumbers,lineWrapping:e.lineWrapping,autoCloseTags:e.autoCloseTags,autoCloseBrackets:e.autoCloseBrackets,highlightSelectionMatches:e.highlightMatches,continueComments:e.continueComments,indentWithTabs:e.indentWithTabs,theme:e.theme,showTrailingSpace:e.showTrailingSpace,showCursorWhenSelecting:true,extraKeys:{"Ctrl-Q":function(z){window["foldFunc_"+q.id](z,z.getCursor().line);}},onKeyEvent:function(B,z){if(e.enableCodeFormatting){var A=x();if(z.type==="keydown"&&z.ctrlKey&&z.keyCode===75&&!z.shiftKey&&!z.altKey){window["codemirror_"+q.id].commentRange(true,A.from,A.to);}else{if(z.type==="keydown"&&z.ctrlKey&&z.keyCode===75&&z.shiftKey&&!z.altKey){window["codemirror_"+q.id].commentRange(false,A.from,A.to);if(e.autoFormatOnUncomment){window["codemirror_"+q.id].autoFormatRange(A.from,A.to);}}else{if(z.type==="keydown"&&z.ctrlKey&&z.keyCode===75&&!z.shiftKey&&z.altKey){window["codemirror_"+q.id].autoFormatRange(A.from,A.to);}}}}}});var p=m.$.clientHeight==0?q.ui.space("contents").getStyle("height"):m.$.clientHeight+"px";var w=m.$.clientWidth+"px";window["codemirror_"+q.id].config=e;if(e.autoFormatOnStart){if(e.useBeautify){var r=4;var u=" ";var n="collapse";var l=window["codemirror_"+q.id].getValue();window["codemirror_"+q.id].setValue(html_beautify(l,r,u,120,n));}else{window["codemirror_"+q.id].autoFormatAll({line:0,ch:0},{line:window["codemirror_"+q.id].lineCount(),ch:0});}}function x(){return{from:window["codemirror_"+q.id].getCursor(true),to:window["codemirror_"+q.id].getCursor(false)};}window["codemirror_"+q.id].on("change",function(){clearTimeout(o);o=setTimeout(function(){var z=window["codemirror_"+q.id];if(z){z.save();}},300);});window["codemirror_"+q.id].setSize(null,p);if(e.lineNumbers&&e.enableCodeFolding){window["codemirror_"+q.id].on("gutterClick",window["foldFunc_"+q.id]);}if(e.highlightActiveLine){window["codemirror_"+q.id].hlLine=window["codemirror_"+q.id].addLineClass(0,"background","activeline");window["codemirror_"+q.id].on("cursorActivity",function(){try{var A=window["codemirror_"+q.id].getLineHandle(window["codemirror_"+q.id].getCursor().line);}catch(z){A=null;}finally{if(A!=null){if(A!=window["codemirror_"+q.id].hlLine){window["codemirror_"+q.id].removeLineClass(window["codemirror_"+q.id].hlLine,"background","activeline");window["codemirror_"+q.id].hlLine=window["codemirror_"+q.id].addLineClass(A,"background","activeline");}}}});}if(typeof e.onLoad==="function"){e.onLoad(window["codemirror_"+q.id],q);}}g.addCommand("source",h.commands.source);if(g.ui.addButton){g.ui.addButton("Source",{label:g.lang.codemirror.toolbar,command:"source",toolbar:"mode,10"});}if(e.enableCodeFormatting){g.addCommand("searchCode",h.commands.searchCode);g.addCommand("autoFormat",h.commands.autoFormat);g.addCommand("commentSelectedRange",h.commands.commentSelectedRange);g.addCommand("uncommentSelectedRange",h.commands.uncommentSelectedRange);g.addCommand("autoCompleteToggle",h.commands.autoCompleteToggle);if(g.ui.addButton){if(e.showFormatButton||e.showCommentButton||e.showUncommentButton||e.showSearchButton){g.ui.add("-",CKEDITOR.UI_SEPARATOR,{toolbar:"mode,30"});}if(e.showFormatButton){g.ui.addButton("autoFormat",{label:j.autoFormat,command:"autoFormat",toolbar:"mode,50"});}if(e.showCommentButton){g.ui.addButton("CommentSelectedRange",{label:j.commentSelectedRange,command:"commentSelectedRange",toolbar:"mode,60"});}if(e.showUncommentButton){g.ui.addButton("UncommentSelectedRange",{label:j.uncommentSelectedRange,command:"uncommentSelectedRange",toolbar:"mode,70"});}if(e.showAutoCompleteButton){g.ui.addButton("AutoComplete",{label:j.autoCompleteToggle,command:"autoCompleteToggle",toolbar:"mode,80"});}}}g.on("beforeModeUnload",function(l){if(g.mode==="source"&&g.plugins.textselection){var m=g.getTextSelection();m.startOffset=LineChannelToOffSet(window["codemirror_"+g.id],window["codemirror_"+g.id].getCursor(true));m.endOffset=LineChannelToOffSet(window["codemirror_"+g.id],window["codemirror_"+g.id].getCursor(false));delete m.element;m.createBookmark();sourceBookmark=true;l.data=m.content;}});g.on("mode",function(){g.getCommand("source").setState(g.mode==="source"?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF);if(g.mode==="source"){g.getCommand("autoCompleteToggle").setState(window["codemirror_"+g.id].config.autoCloseTags?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF);if(g.plugins.textselection&&textRange){var m,l;m=OffSetToLineChannel(window["codemirror_"+g.id],textRange.startOffset);if(typeof(textRange.endOffset)=="undefined"){window["codemirror_"+g.id].focus();window["codemirror_"+g.id].setCursor(m);}else{window["codemirror_"+g.id].focus();l=OffSetToLineChannel(window["codemirror_"+g.id],textRange.endOffset);window["codemirror_"+g.id].setSelection(m,l);}}}});g.on("resize",function(){if(window["editable_"+g.id]&&g.mode==="source"){var m=window["editable_"+g.id].getParent();var l=m.$.clientHeight+"px";var n=m.$.clientWidth+"px";window["codemirror_"+g.id].setSize(n,l);}});g.on("readOnly",function(){if(window["editable_"+g.id]&&g.mode==="source"){window["codemirror_"+g.id].setOption("readOnly",this.readOnly);}});g.on("instanceReady",function(){var l=g.commands.selectAll;if(l!=null){l.exec=function(){if(g.mode==="source"){window["codemirror_"+g.id].setSelection({line:0,ch:0},{line:window["codemirror_"+g.id].lineCount(),ch:0});}else{var n=g.editable();if(n.is("body")){g.document.$.execCommand("SelectAll",false,null);}else{var m=g.createRange();m.selectNodeContents(n);m.select();}g.forceNextSelectionCheck();g.selectionChange();}};}});if(typeof(a)!="undefined"&&a('a[data-toggle="tab"]')&&window["codemirror_"+g.id]){a('a[data-toggle="tab"]').on("shown.bs.tab",function(){window["codemirror_"+g.id].refresh();});}g.on("setData",function(l){if(window["editable_"+g.id]&&g.mode==="source"){window["codemirror_"+g.id].setValue(l.data.dataValue);}});}});var b=CKEDITOR.tools.createClass({base:CKEDITOR.editable,proto:{setData:function(c){this.setValue(c);if(this.codeMirror!=null){this.codeMirror.setValue(c);}this.editor.fire("dataReady");},getData:function(){return this.getValue();},insertHtml:function(){},insertElement:function(){},insertText:function(){},setReadOnly:function(c){this[(c?"set":"remove")+"Attribute"]("readOnly","readonly");},editorID:null,detach:function(){window["codemirror_"+this.editorID].toTextArea();window["editable_"+this.editorID]=null;window["codemirror_"+this.editorID]=null;b.baseProto.detach.call(this);this.clearCustomData();this.remove();}}});})(NS.jQuery);CKEDITOR.plugins.sourcearea={commands:{source:{modes:{wysiwyg:1,source:1},editorFocus:false,readOnly:1,exec:function(a){if(a.mode==="wysiwyg"){a.fire("saveSnapshot");}a.getCommand("source").setState(CKEDITOR.TRISTATE_DISABLED);a.setMode(a.mode==="source"?"wysiwyg":"source");},canUndo:false},searchCode:{modes:{wysiwyg:0,source:1},editorFocus:false,readOnly:1,exec:function(a){CodeMirror.commands.find(window["codemirror_"+a.id]);},canUndo:true},autoFormat:{modes:{wysiwyg:0,source:1},editorFocus:false,readOnly:1,exec:function(b){var a={from:window["codemirror_"+b.id].getCursor(true),to:window["codemirror_"+b.id].getCursor(false)};window["codemirror_"+b.id].autoFormatRange(a.from,a.to);},canUndo:true},commentSelectedRange:{modes:{wysiwyg:0,source:1},editorFocus:false,readOnly:1,exec:function(b){var a={from:window["codemirror_"+b.id].getCursor(true),to:window["codemirror_"+b.id].getCursor(false)};window["codemirror_"+b.id].commentRange(true,a.from,a.to);},canUndo:true},uncommentSelectedRange:{modes:{wysiwyg:0,source:1},editorFocus:false,readOnly:1,exec:function(b){var a={from:window["codemirror_"+b.id].getCursor(true),to:window["codemirror_"+b.id].getCursor(false)};window["codemirror_"+b.id].commentRange(false,a.from,a.to);if(window["codemirror_"+b.id].config.autoFormatOnUncomment){window["codemirror_"+b.id].autoFormatRange(a.from,a.to);}},canUndo:true},autoCompleteToggle:{modes:{wysiwyg:0,source:1},editorFocus:false,readOnly:1,exec:function(a){if(this.state==CKEDITOR.TRISTATE_ON){window["codemirror_"+a.id].setOption("autoCloseTags",false);}else{if(this.state==CKEDITOR.TRISTATE_OFF){window["codemirror_"+a.id].setOption("autoCloseTags",true);}}this.toggleState();},canUndo:true}}};function LineChannelToOffSet(b,c){var a=c.line;var d=c.ch;var e=(a+d);for(i=0;i<a;i++){e+=(b.getLine(i)).length;}return e;}function OffSetToLineChannel(b,e){var a=0,d=0,c=0;for(i=0;i<b.lineCount();i++){len=(b.getLine(i)).length;if(e<c+len){a=i;d=e-c;return{line:a,ch:d};}len++;c+=len;}return{line:a,ch:d};}